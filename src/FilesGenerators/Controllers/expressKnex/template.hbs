const { page } = require('../utils/page')
const { ErrorResponse, CreatedResponse, NoContentResponse, SuccessResponse, Paginate } = require('../responses/index.responses')
const {{entity.name}}Service = require('../services/{{entity.importName}}.service')

class {{entity.name}}Controller {
  {{#if methods.read}}
  async paginate({ tenant, query }, res) {
    try {
      const requestedPage = page(query)
      const {{entity.nameFirstLetterLowerCase}}Service = new {{entity.Name}}Service(tenant)
      const { count, {{entity.paginateObjectName}} } = await {{entity.nameFirstLetterLowerCase}}Service.paginate(requestedPage)

      return Paginate(res, count, requestedPage, {{entity.paginateObjectName}})
    } catch (error) {
      return ErrorResponse(error, res)
    }
  }
  {{/if}}
  {{#if methods.read}}
  async findOne({ tenant, params: { codigo } }, res) {
    try {
      const {{entity.nameFirstLetterLowerCase}}Service = new {{entity.Name}}Service(tenant)
      const {{entity.nameFirstLetterLowerCase}} = await {{entity.nameFirstLetterLowerCase}}Service.findOne(codigo)

      return SuccessResponse(res, {{entity.nameFirstLetterLowerCase}})
    } catch (error) {
      return ErrorResponse(error, res)
    }
  }
  {{/if}}
  {{#if methods.create}}
  async create({ tenant, body }, res) {
    try {
      const {{entity.nameFirstLetterLowerCase}}Service = new {{entity.Name}}Service(tenant)
      const {{entity.nameFirstLetterLowerCase}} = await {{entity.nameFirstLetterLowerCase}}Service.create(body)

      return CreatedResponse(res, {{entity.nameFirstLetterLowerCase}})
    } catch (error) {
      return ErrorResponse(error, res)
    }
  }
  {{/if}}
  {{#if methods.update}}
  async update({ tenant, body, params: { codigo } }, res) {
    try {
      const {{entity.nameFirstLetterLowerCase}}Service = new {{entity.Name}}Service(tenant)
      const {{entity.nameFirstLetterLowerCase}} = await {{entity.nameFirstLetterLowerCase}}Service.update(codigo, body)

      return SuccessResponse(res, {{entity.nameFirstLetterLowerCase}})
    } catch (error) {
      return ErrorResponse(error, res)
    }
  }
  {{/if}}
  {{#if methods.delete}}
  async destroy({ tenant, params: { codigo } }, res) {
    try {
      const {{entity.nameFirstLetterLowerCase}}Service = new {{entity.Name}}Service(tenant)
      await {{entity.nameFirstLetterLowerCase}}Service.destroy(codigo)

      return NoContentResponse(res)
    } catch (error) {
      return ErrorResponse(error, res)
    }
  },
  {{/if}}
};

module.exports = {{entity.name}}Controller